!function(e,t,a,r,n,o,s,p,g,l,_){null!==TribeEventsPro.geocenter.max_lat&&(a.extend(tribe_ev.fn,{map_add_marker:function(e,t,a,r,i){var n=new google.maps.LatLng(e,t),o={position:n,map:s.map};"undefined"!==GeoLoc.pin_url&&GeoLoc.pin_url&&(o.icon=GeoLoc.pin_url),o=new google.maps.Marker(o);var p=new google.maps.InfoWindow,g=a,l=g;r&&(l=l+"<br/>Address: "+r),p.setContent(l),google.maps.event.addListener(o,"click",function(e){p.open(s.map,o)}),s.markers.push(o),s.refine&&o.setVisible(!1),s.bounds.extend(n)}}),s.geocoder=new google.maps.Geocoder,s.bounds=new google.maps.LatLngBounds,a(t).ready(function(){function b(){if(a("#tribe-bar-geoloc").length){var e=a("#tribe-bar-geoloc").val();$fence=a("#tribe_events_filter_item_geofence"),$latlng=a("#tribe-bar-geoloc-lat, #tribe-bar-geoloc-lng"),e.length?$fence.show():($fence.hide(),$latlng.length&&$latlng.val(""))}}function d(){return p.ajax_running=!0,p.params={action:"tribe_geosearch",tribe_paged:p.paged,tribe_event_display:p.view,featured:o.is_featured()},p.category&&(p.params.tribe_event_category=p.category),r.default_permalinks&&(p.params.hasOwnProperty("post.type")||(p.params["post.type"]=l.events_post_type),p.params.hasOwnProperty("eventDisplay")||(p.params.eventDisplay="map")),a(n).trigger("tribe_ev_serializeBar"),a(n).trigger("serialize-bar.tribe"),o.invalid_date_in_params(p.params)?(p.ajax_running=!1,void(invalid_date=!0)):(invalid_date=!1,p.params=a.param(p.params),a(n).trigger("tribe_ev_collectParams"),void a(n).trigger("collect-params.tribe"))}function c(){p.popping||(d(),p.pushstate=!1,p.initial_load||(p.do_string=!0)),invalid_date||(a("#tribe-events-content .tribe-events-loop").tribe_spin(),u(),a.post(GeoLoc.ajaxurl,p.params,function(e){function i(e){for(var t=[],a=0;a<e.length;a++){var r=!1,i=e[a];if(t.forEach(function(e){i.lat==e.lat&&i.lng==e.lng&&i.title!=e.title&&(r=!0,e.title="<center>"+e.title+i.title.link(i.link)+"<center>")}),!r){var n="";n="<center>"+n+i.title.link(i.link)+"</center>",t.push({lat:i.lat,lng:i.lng,title:n,address:i.address})}}return t}if(a(n).trigger("tribe_ev_ajaxStart").trigger("tribe_ev_mapView_AjaxStart"),a(n).trigger("ajax-start.tribe").trigger("map-view-ajax-start.tribe"),o.enable_inputs("#tribe_events_filters_form","input, select"),e.success){p.ajax_running=!1,r.ajax_response={total_count:parseInt(e.total_count),view:e.view,max_pages:e.max_pages,tribe_paged:e.tribe_paged,timestamp:(new Date).getTime()},p.initial_load=!1;var s=a.parseHTML(e.html);a("#tribe-events-content").replaceWith(s),0==e.total_count&&a("#tribe-events-header").hide();var l=[];l=e.markers;var _;if(_=i(l),a.each(_,function(e,t){o.map_add_marker(t.lat,t.lng,t.title,t.address)}),g.pushstate){if(p.page_title=a("#tribe-events-header").data("title"),t.title=p.page_title,p.do_string){var b=p.params.replace(/&?baseurl=[^&]*/i,"");history.pushState({tribe_paged:p.paged,tribe_params:p.params},p.page_title,r.cur_url+"?"+b)}p.pushstate&&history.pushState({tribe_paged:p.paged,tribe_params:p.params},p.page_title,r.cur_url)}a(n).trigger("tribe_ev_ajaxSuccess").trigger("tribe_ev_mapView_AjaxSuccess"),a(n).trigger("ajax-success.tribe").trigger("map-view-ajax-success.tribe"),e.markers.length>0&&m()}}))}function v(e){if("change_view"!=tribe_events_bar_action){if(e.preventDefault(),p.ajax_running)return;p.paged=1,p.view="map",p.popping=!1,g.pushstate?o.pre_ajax(function(){c(null)}):o.pre_ajax(function(){a(n).trigger("tribe_ev_reloadOldBrowser"),a(n).trigger("reload-old-browser.tribe")})}}function u(){if(s.markers){for(i in s.markers)s.markers[i].setMap(null);s.markers.length=0,s.bounds=new google.maps.LatLngBounds}}function m(){s.map.fitBounds(s.bounds),s.map.getZoom()>13&&s.map.setZoom(13)}function f(){a("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").show()}function w(){a("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").hide()}b();var h=a("#tribe-events");$geo_bar_input=a("#tribe-bar-geoloc"),$geo_options=a("#tribe-geo-options"),invalid_date=!1;var x={zoom:5,center:new google.maps.LatLng(TribeEventsPro.geocenter.max_lat,TribeEventsPro.geocenter.max_lng),mapTypeId:google.maps.MapTypeId.ROADMAP};if(t.getElementById("tribe-geo-map")){s.map=new google.maps.Map(t.getElementById("tribe-geo-map"),x),s.bounds=new google.maps.LatLngBounds;var j=new google.maps.LatLng(TribeEventsPro.geocenter.min_lat,TribeEventsPro.geocenter.min_lng);s.bounds.extend(j);var y=new google.maps.LatLng(TribeEventsPro.geocenter.max_lat,TribeEventsPro.geocenter.max_lng);s.bounds.extend(y)}if(a().placeholder&&a("#tribe-geo-location").placeholder(),g.map_view()){var k=o.get_url_param("tribe_paged");tribe_display=o.get_url_param("tribe_event_display"),k&&(p.paged=k),p.view="map","past"==tribe_display&&(p.view="past"),o.tooltips()}if(g.map_view()&&r.params){var L=r.params;o.in_params(L,"tribe_geosearch")>=0||(L+="&action=tribe_geosearch"),o.in_params(L,"tribe_paged")>=0||(L+="&tribe_paged=1"),p.params=L,p.do_string=!1,p.pushstate=!1,p.popping=!0,o.pre_ajax(function(){c()})}else g.map_view()&&(p.do_string=!1,p.pushstate=!1,p.popping=!1,p.initial_load=!0,o.pre_ajax(function(){c()}));if(g.pushstate&&g.map_view()&&(history.replaceState({tribe_paged:p.paged,tribe_params:p.params},"",location.href),a(e).on("popstate",function(e){var t=e.originalEvent.state;t&&(p.do_string=!1,p.pushstate=!1,p.popping=!0,p.params=t.tribe_params,p.paged=t.tribe_paged,o.pre_ajax(function(){c()}),o.set_form(p.params))})),g.map_view()&&(h.on("click",".tribe-geo-option-link",function(e){e.preventDefault(),e.stopPropagation();var t=a(this);a(".tribe-geo-option-link").removeClass("tribe-option-loaded"),t.addClass("tribe-option-loaded"),$geo_bar_input.val(t.text()),a("#tribe-bar-geoloc-lat").val(s.geocodes[t.data("index")].geometry.location.lat()),a("#tribe-bar-geoloc-lng").val(s.geocodes[t.data("index")].geometry.location.lng()),p.do_string=!0,p.pushstate=!1,p.popping=!1,g.pushstate?o.pre_ajax(function(){c(),$geo_options.hide()}):o.pre_ajax(function(){a(n).trigger("tribe_ev_reloadOldBrowser"),a(n).trigger("reload-old-browser.tribe")})}),a(t).on("click",function(){$geo_options.hide()}),o.snap("#tribe-events-content-wrapper","#tribe-events-content-wrapper","#tribe-events-footer .tribe-events-nav-previous a, #tribe-events-footer .tribe-events-nav-next a")),a(n).on("reload-old-browser.tribe",function(){d(),e.location=r.cur_url+"?"+p.params}),g.map_view()){var T;a("#tribe-geo-map-wrapper").resize(function(){T=s.map.getCenter(),google.maps.event.trigger(s.map,"resize"),s.map.setCenter(T)}),a("#tribe-events").on("click","li.tribe-events-nav-next a",function(e){e.preventDefault(),p.ajax_running||("past"===p.view?"1"==p.paged?p.view="map":p.paged--:p.paged++,p.popping=!1,g.pushstate?o.pre_ajax(function(){c()}):o.pre_ajax(function(){a(n).trigger("tribe_ev_reloadOldBrowser"),a(n).trigger("reload-old-browser.tribe")}))}).on("click","li.tribe-events-nav-previous a",function(e){e.preventDefault(),p.ajax_running||("map"===p.view?"1"==p.paged?p.view="past":p.paged--:p.paged++,p.popping=!1,g.pushstate?o.pre_ajax(function(){c(null)}):o.pre_ajax(function(){a(n).trigger("tribe_ev_reloadOldBrowser"),a(n).trigger("reload-old-browser.tribe")}))})}(GeoLoc.map_view&&a("form#tribe-bar-form").length&&g.live_ajax()&&g.pushstate||GeoLoc.map_view&&g.no_bar())&&a("#tribe-events-bar").on("changeDate","#tribe-bar-date",function(e){v(e)}),GeoLoc.map_view&&a(n).on("run-ajax.tribe",function(){c()}),g.map_view()&&(a("form#tribe-bar-form").on("submit",function(){if("change_view"!=tribe_events_bar_action){p.paged=1,f(),a(".tribe-events-sub-nav").remove();var e=a("#tribe-bar-geoloc").val();return""!==e?(p.do_string=!0,p.pushstate=!1,p.popping=!1,u(),a("#tribe-geo-results").empty(),a("#tribe-geo-options").hide(),a("#tribe-geo-options #tribe-geo-links").empty(),o.process_geocoding(e,function(e){s.geocodes=e,w();var t=e[0].geometry.location.lat(),r=e[0].geometry.location.lng();t&&a("#tribe-bar-geoloc-lat").val(t),r&&a("#tribe-bar-geoloc-lng").val(r),s.geocodes.length>1?(o.print_geo_options(),b(),m()):g.pushstate?(b(),c(s.geocodes[0])):(a(n).trigger("tribe_ev_reloadOldBrowser"),a(n).trigger("reload-old-browser.tribe"))}),!1):""===e?(a("#tribe-bar-geoloc-lat").val(""),a("#tribe-bar-geoloc-lng").val(""),a("#tribe-geo-options").hide(),g.pushstate?(p.do_string=!0,p.pushstate=!1,p.popping=!1,b(),c()):(a(n).trigger("tribe_ev_reloadOldBrowser"),a(n).trigger("reload-old-browser.tribe")),w(),!1):!0}}),p.view&&_&&debug.timeEnd("Tribe JS Init Timer")),_&&debug.info("TEC Debug: tribe-events-ajax-maps.js successfully loaded")}))}(window,document,jQuery,tribe_ev.data,tribe_ev.events,tribe_ev.fn,tribe_ev.geoloc,tribe_ev.state,tribe_ev.tests,tribe_js_config,tribe_debug);
